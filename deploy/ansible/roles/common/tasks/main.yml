---
- name: Update apt cache
  raw: apt-get update
  changed_when: false

- name: Install common dependencies
  raw: apt-get install -y git curl wget build-essential ca-certificates gnupg lsb-release
  changed_when: false

- name: Check if Docker is installed
  raw: which docker && docker --version
  register: docker_check
  changed_when: false
  ignore_errors: yes

- name: Docker already installed
  debug:
    msg: "Docker j√° instalado: {{ docker_check.stdout_lines | default(['']) | first }}"
  when: docker_check.rc == 0

- name: Check if docker-compose exists
  raw: which docker-compose || echo "not found"
  register: docker_compose_check
  changed_when: false

- name: Install docker-compose standalone
  raw: |
    curl -L "https://github.com/docker/compose/releases/download/v2.24.0/docker-compose-linux-x86_64" -o /usr/local/bin/docker-compose
    chmod +x /usr/local/bin/docker-compose
  when: "'not found' in docker_compose_check.stdout"
